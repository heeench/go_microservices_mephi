# Go Microservice

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ Go 1.22 —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è >1000 RPS –∏ latency <10ms.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è >1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É —Å latency <10ms
- **–ë—ã—Å—Ç—Ä—ã–π —Ä–æ—É—Ç–∏–Ω–≥**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `httprouter` –≤–º–µ—Å—Ç–æ `gorilla/mux` –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**: `json-iterator` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON
- **Rate Limiting**: –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ (5000 RPS —Å burst 10000)
- **–ú–µ—Ç—Ä–∏–∫–∏ Prometheus**: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Graceful Shutdown**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–∞—É—Ç–æ–º
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ê—É–¥–∏—Ç-–ª–æ–≥–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –∑–∞–ø—Ä–æ—Å—ã

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.22 –∏–ª–∏ –≤—ã—à–µ
- Docker –∏ Docker Compose (–¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏)

## üèÉ –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod tidy

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
go run .

# –ò–ª–∏ —Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
go build -o app.exe .
./app.exe
```

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8080`

## üì° API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

- `GET /api/users` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `GET /api/users/:id` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
- `POST /api/users` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  ```json
  {
    "name": "John Doe",
    "email": "john@example.com"
  }
  ```
- `PUT /api/users/:id` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `DELETE /api/users/:id` ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ú–µ—Ç—Ä–∏–∫–∏

- `GET /metrics` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –ë—ã—Å—Ç—Ä—ã–π —Ä–æ—É—Ç–∏–Ω–≥
- –ó–∞–º–µ–Ω–µ–Ω `gorilla/mux` –Ω–∞ `httprouter` (20-30% –±—ã—Å—Ç—Ä–µ–µ)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é

### 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è JSON –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `json-iterator` (–≤ 2-3 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ `encoding/json`)
- –ü—É–ª –±—É—Ñ–µ—Ä–æ–≤ (`sync.Pool`) –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø–∞–º—è—Ç–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ/–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JSON

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ HTTP —Å–µ—Ä–≤–µ—Ä–∞
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- `ReadHeaderTimeout` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö CPU —è–¥–µ—Ä (`GOMAXPROCS`)

### 4. Rate Limiting
- –õ–∏–º–∏—Ç: 5000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
- Burst: 10000 –∑–∞–ø—Ä–æ—Å–æ–≤
- HTTP 429 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

### 5. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏—Ç-–ª–æ–≥–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üìä –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ wrk

```bash
# –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
wrk -t12 -c400 -d30s http://localhost:8080/api/users

# –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
wrk -t12 -c400 -d30s -s post.lua http://localhost:8080/api/users
```

–ì–¥–µ:
- `-t12` ‚Äî 12 –ø–æ—Ç–æ–∫–æ–≤
- `-c400` ‚Äî 400 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `-d30s` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ 30 —Å–µ–∫—É–Ω–¥

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ hey

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ hey
go install github.com/rakyll/hey@latest

# –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
hey -n 100000 -c 400 -t 4 http://localhost:8080/api/users

# –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
hey -n 100000 -c 400 -t 4 -m POST -H "Content-Type: application/json" -d '{"name":"Test","email":"test@example.com"}' http://localhost:8080/api/users
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

- **RPS**: >1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
- **Latency**: <10ms (p99)
- **–û—à–∏–±–æ–∫**: 0%

## üê≥ Docker

### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

```bash
docker build -t go-microservice .
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker run -p 8080:8080 go-microservice
```

## üê≥ Docker Compose

–ó–∞–ø—É—Å–∫ —Å MinIO –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
docker-compose up --build
```

–°–µ—Ä–≤–∏—Å—ã:
- **App**: `http://localhost:8080`
- **MinIO API**: `http://localhost:9000`
- **MinIO Console**: `http://localhost:9001`

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è MinIO

```env
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=uploads
MINIO_USE_SSL=false
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
go_microservices_mephi/
‚îú‚îÄ‚îÄ main.go                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ handlers/               # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ user_handler.go     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ integration_handler.go
‚îú‚îÄ‚îÄ services/               # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ user_service.go     # –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ integration_service.go
‚îú‚îÄ‚îÄ models/                 # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ user.go
‚îú‚îÄ‚îÄ utils/                  # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ logger.go           # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ rate_limiter.go     # Rate limiting –∏ JSON —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ metrics/                # –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
‚îÇ   ‚îî‚îÄ‚îÄ prometheus.go
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ go.mod                  # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ Prometheus

–î–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ `/metrics`:
- `http_requests_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_duration_seconds` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –º–µ—Ç—Ä–∏–∫

```bash
curl http://localhost:8080/metrics
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DDoS
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (1MB)
- –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- Graceful shutdown –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

## üõ† –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
go mod download
go mod tidy
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

```bash
go fmt ./...
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞

```bash
go vet ./...
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üë• –ê–≤—Ç–æ—Ä—ã

Kopeyka David
